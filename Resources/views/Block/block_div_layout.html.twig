{# Widgets #}

{% block block_widget %}
{% spaceless %}
    {% if compound %}
        {{ block('block_widget_compound') }}
    {% else %}
        {{ block('block_widget_simple') }}
    {% endif %}
{% endspaceless %}
{% endblock block_widget %}

{% block block_component %}
{% endblock block_component %}


{% block block_widget_simple %}
{% spaceless %}
{% if wrapped %}<div{{ block('widget_attributes') }}>{% endif %}{{ value|raw }}{% if wrapped %}</div>{% endif %}
{% endspaceless %}
{% endblock block_widget_simple %}

{% block block_widget_compound %}
{% spaceless %}
    {% if wrapped %}<div{{ block('widget_container_attributes') }}>{% endif %}
        {{ block('block_rows') }}
    {% if wrapped %}</div>{% endif %}
{% endspaceless %}
{% endblock block_widget_compound %}

{% block output_widget %}
{% spaceless %}
    {% if escape %}
        {{ value }}
    {% else %}
        {{ value|raw }}
    {% endif %}
    {{ block('block_rows') }}
{% endspaceless %}
{% endblock output_widget %}

{% block collection_widget %}
{% spaceless %}
    {{ block('block_widget') }}
{% endspaceless %}
{% endblock collection_widget %}

{% block textarea_widget %}
{% spaceless %}
    {% set value = value|raw|nl2br %}
    {{ block('block_widget_simple') }}
{% endspaceless %}
{% endblock textarea_widget %}

{% block choice_widget %}
{% spaceless %}
    {% if expanded %}
        {{ block('choice_widget_expanded') }}
    {% else %}
        {{ block('choice_widget_collapsed') }}
    {% endif %}
{% endspaceless %}
{% endblock choice_widget %}

{% block choice_widget_expanded %}
{% spaceless %}
    {{ block('choice_widget_collapsed') }}
{% endspaceless %}
{% endblock choice_widget_expanded %}

{% block choice_widget_collapsed %}
{% spaceless %}
    {% if multiple %}
        {% set attr = attr|merge({'class': attr.class|default('') ~ ' choice_multiple' }) %}
    {% else %}
        {% set attr = attr|merge({'class': attr.class|default('') ~ ' choice' }) %}
    {% endif %}

    <div{{ block('widget_attributes') }}>
        {% set options = choices %}
        {{ block('choice_widget_options') }}
    </div>
{% endspaceless %}
{% endblock choice_widget_collapsed %}

{% block choice_widget_options %}
{% spaceless %}
    {% for indice in choice_selections %}
        <span class="choice-item{% if inline %} inline{% endif %}">
        {% if route_name is defined and route_name is not null %}
            {% set data_indice = data[indice]|default(data) %}
            {% set route_parameters = route_parameters|merge({(route_id_name): data_indice.id}) %}
            <a href="{{ path(route_name, route_parameters) }}">{{ options[indice].label|trans({}, translation_domain) }}</a>
        {% else %}
            <span>{{ options[indice].label|trans({}, translation_domain) }}</span>
        {% endif %}
        </span>
    {% endfor %}

    {% if choice_selections|length == 0 %}
        <span class="choice-empty">{{ empty_value|trans({}, translation_domain) }}</span>
    {% endif %}
{% endspaceless %}
{% endblock choice_widget_options %}

{% block checkbox_widget %}
{% spaceless %}
    {% set attr = attr|merge({'class': (attr.class|default('') ~ ' block_checkbox ' ~ value)|trim}) %}
    <div{{ block('widget_attributes') }}></div>
{% endspaceless %}
{% endblock checkbox_widget %}

{% block radio_widget %}
{% spaceless %}
    {% if value %}
        {% set attr = attr|merge({'class': (attr.class|default('') ~ ' block_radio checked')|trim}) %}
    {% else %}
        {% set attr = attr|merge({'class': (attr.class|default('') ~ ' block_radio')|trim}) %}
    {% endif %}

    <div{{ block('widget_attributes') }}></div>
{% endspaceless %}
{% endblock radio_widget %}

{% block url_widget %}
{% spaceless %}
    {% set title = title|default(value) %}
    {% set url_attr = url_attr|merge({'href': value, 'tabindex': 0 }) %}
    {% set value %}
        <a {% for attrname, attrvalue in url_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>{{ title|trans({}, translation_domain) }}</a>
    {% endset %}
    {{ block('block_widget_simple') }}
{% endspaceless %}
{% endblock url_widget %}

{% block hidden_widget %}
{% endblock hidden_widget %}

{% block email_widget %}
{% spaceless %}
    {% if mailto %}
        {% set label = label|default(value) %}
        {% set value %}
            <a href="mailto:{{ value }}" tabindex="0">{{ label|trans({}, translation_domain) }}</a>
        {% endset %}
    {% endif %}
    {{ block('block_widget_simple') }}
{% endspaceless %}
{% endblock email_widget %}

{% block entity_widget %}
{% spaceless %}
    {{ block('choice_widget') }}
{% endspaceless %}
{% endblock entity_widget %}


{% block closure_widget %}
{% spaceless %}
    {{ value|raw_closure(block) }}
    {{ block('block_rows') }}
{% endspaceless %}
{% endblock closure_widget %}

{# Labels #}

{% block block_label %}
{% spaceless %}
    {% if not compound %}
        {% set label_attr = label_attr %}
    {% endif %}

    {% set label_attr = label_attr|merge({'class': (label_attr.class|default('') ~ ' block_label')|trim}) %}

    {% if label is null %}
        {% set label = name|block_humanize %}
    {% endif %}

    {% if label != '' %}
        <div{% for attrname, attrvalue in label_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>{{ label|trans({}, translation_domain) }}</div>
    {% endif %}
{% endspaceless %}
{% endblock block_label %}

{# Rows #}

{% block repeated_row %}
{% spaceless %}
    {{ block('block_rows') }}
{% endspaceless %}
{% endblock repeated_row %}

{% block block_row %}
{% spaceless %}
    {% if block.parent.vars.row|default(false) %}
    <div>
    {% endif %}
        {% if block.parent.vars.row|default(false) and block.parent.vars.row_label|default(false) %}
            {{ block_label(block) }}
        {% endif %}
        {{ block_widget(block) }}
    {% if block.parent.vars.row|default(false) %}
    </div>
    {% endif %}
{% endspaceless %}
{% endblock block_row %}

{% block hidden_row %}
    {{ block_widget(block) }}
{% endblock hidden_row %}

{# Misc #}


{# Support #}

{% block block_rows %}
{% spaceless %}
    {% for child in block %}
        {{ block_row(child) }}
    {% endfor %}
{% endspaceless %}
{% endblock block_rows %}

{% block widget_attributes %}
{% if render_id %} id="{{ id }}"{% endif %}{% for attrname, attrvalue in attr %} {% if attrname in ['title'] %}{{ attrname }}="{{ attrvalue|trans({}, translation_domain) }}" {% else %}{{ attrname }}="{{ attrvalue }}"{% endif %}{% endfor %}
{% endblock widget_attributes %}

{% block widget_container_attributes %}
{% if render_id %} id="{{ id }}"{% endif %}{% for attrname, attrvalue in attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}
{% endblock widget_container_attributes %}


{# Twig Widget #}
{% block twig_widget %}
{{ block('block_widget_simple') }}
{% endblock twig_widget %}


{# Form Widget #}
{% block form_row %}
{% spaceless %}
    {{ block_widget(block) }}
{% endspaceless %}
{% endblock form_row %}

{% block form_label %}
{% endblock form_label %}


{% block form_widget %}
    {{ block('form_start_widget') }}
    {{ block('form_content_widget') }}
    {{ block('form_end_widget') }}
{% endblock form_widget %}


{% block form_content_widget %}
    {{ form_widget(block_form) }}
{% endblock form_content_widget %}


{% block form_start_widget %}
    {% if block_form.parent is empty and block_form.children|length > 0 and 'button' not in block_form.vars.block_prefixes %}
        {{ form_start(block_form) }}
    {% endif %}
{% endblock form_start_widget %}


{% block form_end_widget %}
    {% if block_form.parent is empty and block_form.children|length > 0 and 'button' not in block_form.vars.block_prefixes %}
        {{ form_end(block_form) }}
    {% endif %}
{% endblock form_end_widget %}
